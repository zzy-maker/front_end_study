<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    .main .balls {
      width: 450px;
      padding: 30px 10px 10px;
      margin-bottom: 20px;
      position: relative;
      border-radius: 4px;
    }

    .main .balls:after {
      content: "\20";
      clear: both;
      display: block;
      height: 0;
      overflow: hidden;
    }

    .main .balls span {
      position: absolute;
      left: 12px;
      top: 5px;
      font-size: 13px;
    }

    .main b {
      float: left;
      width: 30px;
      height: 30px;
      font-size: 15px;
      background: #fff;
      border: 1px solid;
      border-radius: 50%;
      line-height: 30px;
      text-align: center;
      margin-right: 8px;
      margin-bottom: 8px;
      cursor: pointer;
    }

    .main .red .active {
      background: #f56c6c;
      color: #fff;
    }

    .main .blue .active {
      background: #3a8ee6;
      color: #fff;
    }

    .main .red {
      background: #feeff0;
    }

    .main .red b {
      border-color: #f56c6c;
    }

    .main .blue {
      background: #ecf8ff;
    }

    .main .blue b {
      border-color: #3a8ee6;
    }
  </style>
  <body>
    <!--
      描述
      双色球由33个红球和16个蓝球组成，1注双色球包括6个不重复的红球和1个蓝球。
      请阅读给出的页面和代码，完成 randomFn 函数，实现“随机一注”功能，要求如下：
      函数返回：
        1.以字符串形式输出“随机一注”结果，选中的红蓝球用"|"隔开，红球在前，号码间用半角逗号隔开，如"06,10,13,18,23,27|05"
        2.红球和蓝球号码排列顺序 需与页面展示的顺序对应
      页面交互：
        1.将选中的红球和蓝球（页面中对应DOM元素）用class="active"高亮
        2.将选中的球按号码从小到大排列，移至所属组的前方，结果如示意图所示
        3.每次执行 randomFn 函数，输出符合要求且不完全重复

      注意：
      1、请使用原生JavaScript操作DOM元素，不要增加、删除DOM元素或修改css
      2、请使用ES5语法
      3、答题时不要使用第三方插件
      4、运行浏览器为chrome浏览器
      5、可能涉及的点
      // element.className
      // element.classList
      // element.classList.add
      // element.classList.remove
      // element.getAttribute
      // element.setAttribute
      // element.innerHTML
      // element.insertBefore
      // element.parentNode

      // document.querySelector
      // document.querySelectorAll
      // document.getElementsByTagName
      // document.getElementsByClassName

      // Array.sort
      // Array.push
      // Array.join
      // Array.indexOf
      // Array.forEach
      // Array.map

      // Math.random
      // Math.floor

      // Number.toString()


    -->
    <div class="main">
      <div class="balls red">
        <span>红球</span>
        <div class="balls-wp">
          <b>01</b>
          <b>02</b>
          <b>03</b>
          <b>04</b>
          <b>05</b>
          <b>06</b>
          <b>07</b>
          <b>08</b>
          <b>09</b>
          <b>10</b>
          <b>11</b>
          <b>12</b>
          <b>13</b>
          <b>14</b>
          <b>15</b>
          <b>16</b>
          <b>17</b>
          <b>18</b>
          <b>19</b>
          <b>20</b>
          <b>21</b>
          <b>22</b>
          <b>23</b>
          <b>24</b>
          <b>25</b>
          <b>26</b>
          <b>27</b>
          <b>28</b>
          <b>29</b>
          <b>30</b>
          <b>31</b>
          <b>32</b>
          <b>33</b>
        </div>
      </div>
      <div class="balls blue">
        <span>蓝球</span>
        <div class="balls-wp">
          <b>01</b>
          <b>02</b>
          <b>03</b>
          <b>04</b>
          <b>05</b>
          <b>06</b>
          <b>07</b>
          <b>08</b>
          <b>09</b>
          <b>10</b>
          <b>11</b>
          <b>12</b>
          <b>13</b>
          <b>14</b>
          <b>15</b>
          <b>16</b>
        </div>
      </div>
    </div>
    <script>
      console.log(randomFn());

      randomFn();

      // 方法1
      function randomFn() {
        // 红球节点以及所有红球
        const redBallRoot = document.querySelector(".red .balls-wp");
        const redBallList = redBallRoot.children;
        // 蓝球节点以及所有红球
        const blueBallRoot = document.querySelector(".blue  .balls-wp");
        const blueBallList = blueBallRoot.children;

        let redNumList = [];
        let blueNumList = [];
        // 红球蓝球数字格式化
        for (var i = 0; i < redBallList.length; i++) {
          redNumList.push(i + 1 < 10 ? `0${i + 1}` : `${i + 1}`);
        }
        for (var i = 0; i < blueBallList.length; i++) {
          blueNumList.push(i + 1 < 10 ? `0${i + 1}` : `${i + 1}`);
        }
        // 生成不重复的随机数
        function getRandomNums(num, list) {
          // 随机球数组
          const rsltList = [];
          for (var i = 0; i < num; i++) {
            // 随机生成一枚球
            const getNumber = () => {
              const getRslt = parseInt(Math.random() * list.length);
              if (list[getRslt] && rsltList.indexOf(list[getRslt]) === -1) {
                // 随机球若不存在则插入随机球数组里
                return rsltList.push(list[getRslt]);
              }
              // 若存在则继续递归，直到随机球不存在
              else return getNumber();
              return;
            };
            getNumber();
          }
          return rsltList;
        }
        // 红蓝随机球数组 大小排序
        const headReds = getRandomNums(6, redNumList).sort(
          (a, b) => parseInt(a) - parseInt(b)
        );
        const headBlues = getRandomNums(1, blueNumList).sort(
          (a, b) => parseInt(a) - parseInt(b)
        );
        // 最终红蓝球数组
        const rsltListRed = headReds.concat(
          redNumList.filter((e) => headReds.indexOf(e) === -1)
        );
        const rsltListBlue = headBlues.concat(
          blueNumList.filter((e) => headBlues.indexOf(e) === -1)
        );
        // 遍历最终数组进行dom操作，修改节点内容 以及添加active class
        for (var i = 0; i < rsltListRed.length; i++) {
          redBallList[i].innerText = rsltListRed[i];
          if (i < 6) {
            redBallList[i].classList.add("active");
          }
        }
        for (var i = 0; i < rsltListBlue.length; i++) {
          blueBallList[i].innerText = rsltListBlue[i];
          if (i < 1) {
            blueBallList[i].classList.add("active");
          }
        }
        //
        // 返回字符串拼接 ES6的模板字符串不可以使用
        const resltString = headReds.join(",") + "|" + headBlues.join("");
        return resltString;
      }

      // 方法2
      function randomFn() {
        return selectBall("red", 6) + "|" + selectBall("blue", 1);
      }
      function selectBall(color, n) {
        var wrap = document.querySelector("." + color + " .balls-wp");
        var balls = wrap.getElementsByTagName("b");
        // 遍历初始化，去掉多余类
        for (var i = 1; i <= n; i++) {
          balls[i].classList.remove("active");
        }
        var choosed = [];
        // 随机生成n个球
        for (var i = 1; i <= n; i++) {
          var index = Math.floor(Math.random() * balls.length);
          balls[index].classList.add("active");
          choosed.push(balls[index]);
          balls[index].remove();
        }
        // 排序
        choosed.sort(function (a, b) {
          return a.textContent - b.textContent;
        });
        // 把选中的球 移到前面
        for (var i = n - 1; i >= 0; i--) {
          wrap.insertBefore(choosed[i], balls[0]);
        }
        // 返回
        return choosed.map((i) => i.textContent).join(",");
      }
    </script>
  </body>
</html>
